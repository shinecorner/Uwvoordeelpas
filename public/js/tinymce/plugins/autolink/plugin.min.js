tinymce.PluginManager.add("autolink",function(e){function t(e){o(e,-1,"(",!0)}function n(e){o(e,0,"",!0)}function i(e){o(e,-1,"",!1)}function o(e,t,n){function i(e,t){if(0>t&&(t=0),3==e.nodeType){var n=e.data.length;t>n&&(t=n)}return t}function o(e,t){1!=e.nodeType||e.hasChildNodes()?f.setStart(e,i(e,t)):f.setStartBefore(e)}function r(e,t){1!=e.nodeType||e.hasChildNodes()?f.setEnd(e,i(e,t)):f.setEndAfter(e)}var f,a,s,l,c,u,g,h,C,y;if("A"!=e.selection.getNode().tagName){if(f=e.selection.getRng(!0).cloneRange(),f.startOffset<5){if(h=f.endContainer.previousSibling,!h){if(!f.endContainer.firstChild||!f.endContainer.firstChild.nextSibling)return;h=f.endContainer.firstChild.nextSibling}if(C=h.length,o(h,C),r(h,C),f.endOffset<5)return;a=f.endOffset,l=h}else{if(l=f.endContainer,3!=l.nodeType&&l.firstChild){for(;3!=l.nodeType&&l.firstChild;)l=l.firstChild;3==l.nodeType&&(o(l,0),r(l,l.nodeValue.length))}a=1==f.endOffset?2:f.endOffset-1-t}s=a;do o(l,a>=2?a-2:0),r(l,a>=1?a-1:0),a-=1,y=f.toString();while(" "!=y&&""!==y&&160!=y.charCodeAt(0)&&a-2>=0&&y!=n);f.toString()==n||160==f.toString().charCodeAt(0)?(o(l,a),r(l,s),a+=1):0===f.startOffset?(o(l,0),r(l,s)):(o(l,a),r(l,s)),u=f.toString(),"."==u.charAt(u.length-1)&&r(l,s-1),u=f.toString(),g=u.match(d),g&&("www."==g[1]?g[1]="http://www.":/@$/.test(g[1])&&!/^mailto:/.test(g[1])&&(g[1]="mailto:"+g[1]),c=e.selection.getBookmark(),e.selection.setRng(f),e.execCommand("createlink",!1,g[1]+g[2]),e.selection.moveToBookmark(c),e.nodeChanged())}}var r,d=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;return e.settings.autolink_pattern&&(d=e.settings.autolink_pattern),e.on("keydown",function(t){return 13==t.keyCode?i(e):void 0}),tinymce.Env.ie?void e.on("focus",function(){if(!r){r=!0;try{e.execCommand("AutoUrlDetect",!1,!0)}catch(t){}}}):(e.on("keypress",function(n){return 41==n.keyCode?t(e):void 0}),void e.on("keyup",function(t){return 32==t.keyCode?n(e):void 0}))});